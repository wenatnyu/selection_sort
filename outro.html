<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fake Java Online Compiler</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.88);
      --muted: rgba(255,255,255,.55);
      --border: rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Noto Sans CJK SC", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      background:
        radial-gradient(900px 400px at 50% 0%, rgba(65,201,255,.08), transparent 80%),
        var(--bg);
      color: var(--text);
      font-family: var(--sans);
      display:flex; flex-direction:column;
      overflow:hidden;
    }

    /* Top Bar */
    .topbar{
      height: 56px;
      display:flex; align-items:center; justify-content:space-between;
      padding: 0 20px;
      border-bottom: 1px solid var(--border);
      background: rgba(11,16,32,.6);
      backdrop-filter: blur(12px);
      z-index: 10;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight: 600; font-size:15px; letter-spacing:.5px;
    }
    .brand svg{ width:20px; height:20px; fill: #41c9ff; }
    
    .actions{ display:flex; gap:12px; }
    .btn{
      border:1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      padding: 6px 14px;
      border-radius: 8px;
      font-size:13px;
      cursor:pointer;
      transition: all .2s;
    }
    .btn:hover{ background: var(--panel2); border-color: rgba(255,255,255,.3); }
    .btn.run{
      background: #2ecc71; 
      border-color: #27ae60; 
      color: #000; 
      font-weight:600; 
      box-shadow: 0 0 15px rgba(46,204,113,.4);
    }
    .btn.run:hover{ background: #2bd47d; box-shadow: 0 0 25px rgba(46,204,113,.6); }
    .btn:disabled{ opacity:.5; cursor:not-allowed; box-shadow:none; filter:grayscale(1); }

    /* Main Layout */
    .main{
      flex:1;
      display:flex;
      overflow:hidden;
    }

    /* Editor Pane (Left) */
    .editorPane{
      flex: 6;
      display:flex; flex-direction:column;
      border-right: 1px solid var(--border);
      background: rgba(0,0,0,.15);
      position:relative;
    }
    .tabs{
      display:flex; 
      background: rgba(0,0,0,.2);
      border-bottom: 1px solid var(--border);
    }
    .tab{
      padding: 10px 16px;
      font-size:13px;
      color: var(--muted);
      border-right: 1px solid var(--border);
      cursor:pointer;
      display:flex; align-items:center; gap:6px;
    }
    .tab.active{ color: #41c9ff; background: var(--bg); border-top: 2px solid #41c9ff; }
    
    .codeArea{
      flex:1;
      display:flex;
      position:relative;
      overflow:hidden;
    }
    .gutter{
      width: 46px;
      padding: 16px 0;
      background: rgba(0,0,0,.2);
      border-right: 1px solid var(--border);
      text-align:right;
      font-family: var(--mono);
      font-size:13px;
      line-height: 22px;
      color: rgba(255,255,255,.2);
      user-select:none;
    }
    .gutter div{ padding-right:12px; }

    .editorMain{
      flex:1;
      position:relative;
      overflow:hidden;
    }
    
    .codeLayer{
      position:absolute; inset:0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      gap: 10px;
    }
    
    .codeImage {
      display: block;
      width: 100%;
      height: auto;
      object-fit: contain;
      object-position: left top;
    }
    .waveImage{
      display:block;
      width:40%;
      height:auto;
      object-fit:contain;
      object-position: left top;
      border-radius: 6px;
      box-shadow: 0 10px 22px rgba(0,0,0,.2);
    }

    /* Console Pane (Right) */
    .consolePane{
      flex: 4;
      display:flex; flex-direction:column;
      background: #0d1224;
    }
    .consoleHeader{
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:1px;
      color: var(--muted);
      display:flex; justify-content:space-between;
    }
    .consoleBody{
      flex:1;
      padding: 16px;
      font-family: var(--mono);
      /* 修改点1：字体放大，从 13px -> 17px */
      font-size: 17px; 
      line-height: 1.6;
      color: #ccc;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .consoleLine{ margin-bottom:6px; opacity:0; animation: fadeIn .2s forwards; }
    .consoleLine.error{ color: #ff5f56; }
    .consoleLine.success{ color: #2ecc71; }
    .consoleLine.info{ color: #41c9ff; }
    .consoleLine.system{ color: #888; font-style:italic; }

    @keyframes fadeIn { to{ opacity:1; } }

    /* Overlay (Fireworks + Text) */
    .overlay{
      position:fixed; inset:0;
      background: rgba(11,16,32,.85);
      backdrop-filter: blur(8px);
      z-index: 100;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      opacity:0; pointer-events:none;
      transition: opacity .5s ease;
    }
    body.running .overlay{ opacity:1; pointer-events:auto; }

    canvas{
      position:absolute; inset:0; pointer-events:none;
    }
    
    .centerText{
      position:relative; z-index:2;
      font-size: clamp(24px, 4vw, 42px);
      font-weight: 700;
      text-align:center;
      line-height: 1.4;
      background: linear-gradient(135deg, #fff 30%, #41c9ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      opacity:0; transform: translateY(20px);
      transition: all .8s cubic-bezier(.2,.8,.2,1);
      max-width: 80%;
    }
    body.showText .centerText{
      opacity:1; transform: translateY(0);
    }
    
    .cursor{
      display:inline-block; width:3px; height:1em;
      background: #41c9ff;
      vertical-align: text-bottom;
      animation: blink 1s infinite;
    }
    @keyframes blink{ 50%{ opacity:0; } }

  </style>
</head>
<body>

  <div class="topbar">
    <div class="brand">
      <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
      <span>Java Online Compiler</span>
    </div>
    <div class="actions">
      <button class="btn" disabled>Settings</button>
      <button class="btn" disabled>Share</button>
      <button class="btn run" id="runBtn">Run ▶</button>
    </div>
  </div>

  <div class="main">
    <div class="editorPane">
      <div class="tabs">
        <div class="tab active">Main.java</div>
        <div class="tab">Solution.java</div>
      </div>
        <div class="codeArea">
          <div class="gutter" id="gutter"></div>
          <div class="editorMain">
            <div class="codeLayer">
              <img src="outro.png" class="codeImage" id="codeImage" alt="Java Code Screenshot" />
              <img src="wave.png" class="waveImage" alt="Wave decoration" />
            </div>
          </div>
        </div>
      </div>

    <div class="consolePane">
      <div class="consoleHeader">
        <span>Console / Terminal</span>
        <span style="cursor:pointer" onclick="clearConsole()">Clear</span>
      </div>
      <div class="consoleBody" id="consoleBody">
        <div class="consoleLine system">/**********************************************
Online Java Compiler.Code, Compile, Run and Debug java program online.
            /**********************************************</div>
        <div class="consoleLine system">Ready to compile. Press "Run" to start.</div>
        


      </div>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <canvas id="fireworks"></canvas>
    <div class="centerText">
      <span id="typebox"></span><span class="cursor"></span>
    </div>
  </div>

  <script>
    // 1. Gutter Line Numbers
    const gutter = document.getElementById("gutter");
    for(let i=1; i<=30; i++){
      const d = document.createElement("div");
      d.textContent = i;
      gutter.appendChild(d);
    }

    // 2. Console Logic
    const consoleBody = document.getElementById("consoleBody");
    const runBtn = document.getElementById("runBtn");
    const overlay = document.getElementById("overlay");
    const typebox = document.getElementById("typebox");
    let typingTimer = null;

    function clearConsole(){
      consoleBody.innerHTML = '<div class="consoleLine system">Console cleared.</div>';
    }

    function appendConsoleLine(text, type=""){
      const div = document.createElement("div");
      div.className = `consoleLine ${type}`;
      div.textContent = text;
      consoleBody.appendChild(div);
      consoleBody.scrollTop = consoleBody.scrollHeight;
      return div; // 返回元素引用，方便后续修改
    }

    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    async function runFake(){
      if (runBtn.disabled) return;
      runBtn.disabled = true;
      runBtn.textContent = "Compiling...";

      appendConsoleLine("Compiling Main.java...", "system");
      await sleep(800);
      appendConsoleLine("Generating bytecode...", "system");
      await sleep(800);
      appendConsoleLine("Build Success! (1.2s)", "success");
      await sleep(500);
      
      // === 修改点2：5秒倒计时逻辑 ===
      
      // 先创建一行用于显示倒计时的文字
      const runningLine = appendConsoleLine("Running...", "info");
      
      // 循环 5 次，每次间隔 1 秒
      for(let i = 5; i > 0; i--) {
        runningLine.textContent = `Running... (${i}s)`;
        // 自动滚动到底部
        consoleBody.scrollTop = consoleBody.scrollHeight;
        await sleep(1000);
      }
      
      // 倒计时结束
      runningLine.textContent = "Running... Done.";
      await sleep(500);

      // === 倒计时结束后，显示烟花遮罩层 ===
      document.body.classList.add("running"); 
      overlay.setAttribute("aria-hidden", "false");
      
      startFireworks();
      await sleep(1000); 

      document.body.classList.add("showText");
      const msg = "很开心在2025年的最后一天见到你们，祝大家2026年元旦快乐！";
      typewriter(msg, 60);
    }

    // Typewriter Effect
    function typewriter(text, speed){
      let i = 0;
      typebox.textContent = "";
      clearInterval(typingTimer);
      typingTimer = setInterval(() => {
        if (i < text.length) {
          typebox.textContent += text.charAt(i);
          i++;
        } else {
          clearInterval(typingTimer);
          runBtn.textContent = "Run ▶"; 
        }
      }, speed);
    }

    // 3. Fireworks Logic (Canvas)
    const canvas = document.getElementById("fireworks");
    const ctx = canvas.getContext("2d");
    let particles = [];
    let animationId = null;
    let audioCtx = null;
    let musicTimer = null;

    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === "suspended") audioCtx.resume();
      return audioCtx;
    }

    function playBoom(){
      const ctxA = ensureAudio();
      const osc = ctxA.createOscillator();
      const gain = ctxA.createGain();
      const now = ctxA.currentTime;
      osc.type = "triangle";
      osc.frequency.setValueAtTime(180 + Math.random()*120, now);
      osc.frequency.exponentialRampToValueAtTime(70, now + 0.6);
      gain.gain.setValueAtTime(0.18, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.7);
      osc.connect(gain).connect(ctxA.destination);
      osc.start(now);
      osc.stop(now + 0.8);
    }

    function playNote(freq, dur = 0.35){
      const ctxA = ensureAudio();
      const osc = ctxA.createOscillator();
      const gain = ctxA.createGain();
      const now = ctxA.currentTime;
      osc.type = "sine";
      osc.frequency.setValueAtTime(freq, now);
      gain.gain.setValueAtTime(0.05, now);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + dur);
      osc.connect(gain).connect(ctxA.destination);
      osc.start(now);
      osc.stop(now + dur + 0.05);
    }

    function startMusic(){
      stopMusic();
      const base = 392; // G4
      const scale = [0, 3, 5, 7, 10, 12].map(semi => base * Math.pow(2, semi/12));
      musicTimer = setInterval(() => {
        const pick = scale[Math.floor(Math.random()*scale.length)];
        playNote(pick, 0.4);
      }, 420);
    }

    function stopMusic(){
      if (musicTimer){
        clearInterval(musicTimer);
        musicTimer = null;
      }
    }

    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    class Particle {
      constructor(x, y, color) {
        this.x = x; this.y = y;
        this.color = color;
        const angle = Math.random() * Math.PI * 2;
        const velocity = Math.random() * 4 + 1; 
        this.dx = Math.cos(angle) * velocity;
        this.dy = Math.sin(angle) * velocity;
        this.alpha = 1;
        this.decay = Math.random() * 0.015 + 0.005;
      }
      draw() {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }
      update() {
        this.x += this.dx;
        this.y += this.dy;
        this.dy += 0.05; 
        this.alpha -= this.decay;
      }
    }

    function createFirework(x, y) {
      const colors = ["#ff4b4b", "#ffb703", "#41c9ff", "#2ecc71", "#ffffff"];
      const color = colors[Math.floor(Math.random() * colors.length)];
      for (let i = 0; i < 40; i++) {
        particles.push(new Particle(x, y, color));
      }
      playBoom();
    }

    function animate() {
      animationId = requestAnimationFrame(animate);
      ctx.fillStyle = "rgba(11, 16, 32, 0.2)"; 
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (Math.random() < 0.03) {
        createFirework(
          Math.random() * canvas.width,
          Math.random() * canvas.height * 0.6 
        );
      }

      particles.forEach((p, index) => {
        p.update();
        p.draw();
        if (p.alpha <= 0) particles.splice(index, 1);
      });
    }

    function startFireworks(){
      particles = [];
      if (!animationId) animate();
      startMusic();
    }
    function stopFireworks(){
      cancelAnimationFrame(animationId);
      animationId = null;
      ctx.clearRect(0,0,canvas.width, canvas.height);
      stopMusic();
    }

    // 4. Interaction Events
    runBtn.addEventListener("click", runFake);
    
    const codeImage = document.getElementById("codeImage");
    if (codeImage) {
      codeImage.addEventListener("click", runFake);
    }

    function exitOverlay(){
      if (!document.body.classList.contains("running")) return;

      document.body.classList.remove("running");
      document.body.classList.remove("showText");
      overlay.setAttribute("aria-hidden", "true");

      clearInterval(typingTimer);
      typebox.textContent = "";
      stopFireworks();

      runBtn.disabled = false;
      runBtn.textContent = "Run ▶";
      appendConsoleLine("[Done] Happy New Year!", "system");
    }

    overlay.addEventListener("click", exitOverlay);

    window.addEventListener("keydown", (e) => {
      const isMac = navigator.platform.toUpperCase().includes("MAC");
      if ((isMac ? e.metaKey : e.ctrlKey) && e.key === "Enter") {
        e.preventDefault();
        if (!runBtn.disabled) runFake();
      }
      if (e.key === "Escape") exitOverlay();
    });

  </script>
</body>
</html>
